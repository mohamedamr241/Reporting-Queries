SELECT
  asset_type,
  COUNT(*) AS total
FROM container_assets
GROUP BY asset_type;



SELECT
  container_type,
  COUNT(*) AS total
FROM container_assets
WHERE asset_type = 'connection'
  AND created_on >= TO_TIMESTAMP('2022-01-01', 'YYYY-MM-DD')
GROUP BY container_type;



SELECT
  at.tag_name,
  ca.asset_type,
  COUNT(*) AS total
FROM asset_tags at
JOIN container_assets ca
  ON at.asset_id = ca.asset_id
GROUP BY at.tag_name, ca.asset_type;



SELECT *
FROM container_assets
WHERE container_type = 'catalog'
  AND TRIM(description) IS NULL;




SELECT
  ga.name,
  aggr_table.total
FROM governance_artifacts ga
LEFT JOIN (
  SELECT
    associated_artifact_id,
    COUNT(*) AS total
  FROM governance_artifact_container_associations
  WHERE associated_artifact_type = 'glossary_term'
  GROUP BY associated_artifact_id
) aggr_table
  ON ga.artifact_id = aggr_table.associated_artifact_id
WHERE ga.artifact_type = 'glossary_term';




SELECT
  header,
  COUNT(*) AS total
FROM (
  SELECT
    CASE
      WHEN gacca.associated_artifact_id IS NULL THEN 'NO TERMS'
      ELSE 'HAS ATLEAST ONE TERM'
    END AS header
  FROM containers c
  JOIN container_assets ca
    ON c.container_id = ca.container_id
  LEFT JOIN governance_artifact_container_associations gacca
    ON ca.asset_id = gacca.asset_id
   AND gacca.associated_artifact_type = 'glossary_term'
  WHERE c.container_type = 'catalog'
) temp_table
GROUP BY header;




SELECT
  ca.container_id,
  ca.asset_id,
  ca.name,
  ca.asset_type
FROM asset_collaborators ac
JOIN container_assets ca
  ON ca.asset_id = ac.asset_id
 AND ca.container_id = ac.container_id
WHERE ac.user_id = 'IBMid-50DW59BCGD'
  AND ca.container_type = 'catalog';




SELECT
  ca.name AS asset_name,
  temp.tech_start AS update_time,
  temp.tech_start,
  temp.asset_id,
  temp.tech_end,
  temp.quality_score
FROM container_assets ca
JOIN (
  SELECT
    cda.asset_id,
    cda.quality_score,
    cda.tech_start,
    cda.tech_end
  FROM container_data_assets cda
  WHERE cda.asset_id = '130ab82a-c3a4-4fbc-880b-51bc49517ebe'
    AND cda.quality_score IS NOT NULL

  UNION

  SELECT
    hcda.asset_id,
    hcda.quality_score,
    hcda.tech_start,
    hcda.tech_end
  FROM hist_container_data_assets hcda
  WHERE hcda.asset_id = '130ab82a-c3a4-4fbc-880b-51bc49517ebe'
    AND hcda.quality_score IS NOT NULL
) temp
  ON temp.asset_id = ca.asset_id;




SELECT
  dr.rule_id,
  dr.name AS rule_name,
  ca.owner,
  ca.created_on,
  ca.modified_by,
  ca.modified_on,
  dr.output_asset_id,
  dr.output_asset_container_id,
  caout.name AS output_asset_name,
  cdacout.name AS column_name
FROM dq_rules dr
JOIN container_assets ca
  ON ca.container_id = dr.container_id
 AND ca.asset_id = dr.rule_id
JOIN container_assets caout
  ON caout.container_id = dr.output_asset_container_id
 AND caout.asset_id = dr.output_asset_id
JOIN container_data_assets cdaout
  ON cdaout.container_id = caout.container_id
 AND cdaout.asset_id = caout.asset_id
JOIN container_data_asset_columns cdacout
  ON cdacout.container_id = cdaout.container_id
 AND cdacout.asset_id = cdaout.asset_id;
